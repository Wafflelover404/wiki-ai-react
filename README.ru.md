# WikiAI React

**[English](README.md)** | **[Русский](README.ru.md)**

Современное фронтенд-приложение Next.js 16 для системы баз знаний GraphTalk. Предоставляет интуитивно понятный веб-интерфейс для запросов к базам знаний, управления файлами, взаимодействия с возможностями поиска на основе ИИ и комплексными административными инструментами.

## Возможности

### Основная функциональность
- **Поиск на основе ИИ**: Семантический поиск с потоковыми ответами в реальном времени и улучшенным режимом AI-агента
- **Расширенное управление файлами**: Загрузка, просмотр и управление документами базы знаний с комплексными метаданными
- **Интерфейс AI-агента**: Командные взаимодействия со специальным XML-подобным синтаксисом для расширенных запросов
- **Поддержка мульти-тенантности**: Архитектура на основе организаций с управлением пользователями и контролем доступа
- **Аналитика в реальном времени**: Комплексная панель управления с отслеживанием объема запросов и метриками поведения пользователей
- **Система управления контентом**: Интегрированная CMS для блогов, статей помощи и управления медиа
- **Интерактивная система викторин**: Создание и управление викторинами с детальной аналитикой и отчетностью
- **Управление API ключами**: Безопасная генерация API ключей с гранулярными разрешениями и отслеживанием использования

### Пользовательский интерфейс
- **Адаптивный дизайн**: Оптимизирован для настольных и мобильных устройств
- **Современный UI**: Построен на Tailwind CSS 4 и компонентах Radix UI
- **Потоковая передача WebSocket**: Ответы LLM токен-за-токеном в реальном времени
- **Административная панель**: Комплексный административный интерфейс с метриками в реальном времени
- **Управление организациями**: Управление жизненным циклом мульти-тенантных организаций
- **Система приглашений**: Безопасная регистрация пользователей на основе приглашений с контролем истечения срока

## Технологический стек

### Фронтенд-фреймворк
- **Фреймворк**: Next.js 16 с App Router
- **UI библиотека**: React 19, Tailwind CSS 4
- **Компоненты**: Radix UI, библиотека компонентов shadcn/ui
- **Управление состоянием**: Zustand для глобального состояния
- **Формы**: React Hook Form + валидация Zod
- **Диаграммы**: Recharts для визуализации данных
- **Карты**: Leaflet для географических функций

### Интеграция с бэкендом
- **API клиент**: Пользовательский API клиент с конфигурацией на основе окружения
- **WebSocket**: Потоковая передача в реальном времени для ответов ИИ
- **Аутентификация**: Аутентификация на основе JWT с управлением сессиями
- **Обработка файлов**: Мультиформатный просмотрщик и система загрузки файлов

## Быстрый старт

### Необходимые условия

- Node.js 18+
- pnpm (или npm/yarn)
- Бэкенд GraphTalk, работающий на `http://localhost:9001` (или настройте любой другой URL в .env)

### Установка

```bash
# Установка зависимостей
pnpm install

# Копирование конфигурации окружения
cp .env.example .env
# Отредактируйте .env с вашим URL бэкенда

# Запуск сервера разработки
pnpm dev
```

Приложение будет доступно по адресу `http://localhost:3000`

### Конфигурация окружения

Отредактируйте `.env` для настройки подключения к бэкенду:

```bash
# Локальная разработка
NEXT_PUBLIC_API_URL=http://localhost:9001
NEXT_PUBLIC_WS_URL=ws://localhost:9001

# Продакшн
NEXT_PUBLIC_API_URL=https://api.wikiai.by
NEXT_PUBLIC_WS_URL=wss://api.wikiai.by
```

## Использование

### Аутентификация

Перейдите к `/login` для доступа к приложению. Доступны три режима аутентификации:

#### Вход
- Аутентификация по email и паролю
- Контроль доступа на основе организаций
- Управление сессиями с автоматическим обновлением

#### Создание организации
- Регистрация новой организации с системой приглашений
- Многошаговый процесс регистрации
- Рабочий процесс одобрения администратором

#### Режим AI-агента
- Прямые команды AI-агента (аутентификация не требуется)
- Взаимодействия с ИИ в реальном времени
- Система запросов на основе команд

### Команды AI-агента

Используйте специальные XML-подобные команды во вкладке AI-агента:

```html
<!-- Получить содержимое файла -->
<file-content>filename.md</file-content>

<!-- Получить файл по ID -->
<file-id>123</file-id>

<!-- Нечеткий поиск имен файлов -->
<fuzzy-search>поисковый термин</fuzzy-search>

<!-- Поиск по базе знаний -->
<kb-search>запрос</kb-search>

<!-- Семантический ИИ-поиск -->
<semantic-search>запрос</semantic-search>
```

Пример с несколькими командами:
```
Анализ ценностей компании и поиск правил коммуникации:
<file-content>ЦЕННОСТИ КОМПАНИИ.md</file-content>
<fuzzy-search>правила</fuzzy-search>
<semantic-search>ценности компании</semantic-search>
```

### Режимы поиска

#### Стандартный поиск
- Быстрый поиск на основе ключевых слов
- Подсветка результатов в реальном времени
- Фильтрация файлов и контента

#### Улучшенный поиск AI-агента
- Улучшенная стратегия поиска с обработкой ИИ
- Оценка релевантности и ранжирование
- Обработка результатов с учетом контекста
- Потоковые ответы в реальном времени

### Управление файлами

#### Просмотрщик файлов
Унифицированный просмотрщик файлов поддерживает:
- PDF документы с навигацией по страницам
- Word документы (.doc, .docx) с сохранением форматирования
- Изображения (png, jpg, svg, webp) с возможностью масштабирования
- Текстовые файлы с подсветкой синтаксиса
- Полноэкранный режим и функциональность загрузки

#### Загрузка файлов
- Интерфейс перетаскивания
- Поддержка пакетной загрузки
- Отслеживание прогресса
- Валидация типов файлов
- Извлечение метаданных

### Административная панель

#### Обзор аналитики
- Отслеживание объема запросов в реальном времени
- Аналитика поведения пользователей
- Метрики производительности
- Настраиваемые периоды времени (7, 14, 30, 90 дней)

#### Управление организациями
- Создание и одобрение организаций
- Управление статусами (ожидает, активна, отклонена)
- Система приглашений с контролем истечения срока
- Управление членством пользователей

#### Управление контентом
- Создание и редактирование постов в блоге
- Управление статьями помощи
- Организация медиа файлов
- Рабочий процесс публикации контента

### Система викторин

#### Создание викторин
- Интерактивный конструктор викторин
- Множественные типы вопросов
- Поддержка форматированного текста
- Интеграция медиа

#### Аналитика викторин
- Отслеживание ответов
- Метрики производительности
- Аналитика вовлеченности пользователей
- Детальная отчетность

## Структура проекта

```
wiki-ai-react/
├── app/                    # Страницы Next.js App Router
│   ├── app/               # Основные страницы приложения
│   │   ├── files/         # Интерфейс управления файлами
│   │   ├── admin/         # Административная панель
│   │   │   ├── dashboard/ # Панель аналитики
│   │   │   ├── organizations/ # Управление организациями
│   │   │   ├── search/    # Интерфейс административного поиска
│   │   │   └── content/   # Управление контентом
│   │   ├── chat/          # Интерфейс чата
│   │   ├── search/        # Публичный интерфейс поиска
│   │   └── settings/      # Настройки пользователя
│   ├── login/             # Страницы аутентификации
│   ├── invite/            # Система приглашений
│   └── layout.tsx         # Корневой макет
├── components/            # React компоненты
│   ├── ui/               # Базовые UI компоненты (shadcn)
│   ├── cms-*.tsx         # CMS компоненты
│   ├── admin-*.tsx       # Административные компоненты
│   ├── file-*.tsx        # Компоненты управления файлами
│   └── *.tsx            # Функциональные компоненты
├── hooks/                # Пользовательские React хуки
├── lib/                  # Утилиты и API клиент
│   ├── api.ts           # Функции API клиента
│   ├── config.ts        # Константы конфигурации
│   └── utils.ts         # Утилитарные функции
├── styles/              # Глобальные стили
└── public/               # Статические ресурсы
```

## Ключевые компоненты

| Компонент | Описание |
|-----------|-------------|
| `UnifiedFileReader` | Мультиформатный просмотрщик файлов с полноэкранным режимом и загрузкой |
| `ChatInterface` | Чат в реальном времени с потоковой передачей WebSocket |
| `AICommandInput` | Парсер и исполнитель команд AI-агента |
| `SearchPanel` | UI семантического и ключевого поиска с режимом AI-агента |
| `FileUpload` | Загрузка файлов перетаскиванием с отслеживанием прогресса |
| `AdminDashboard` | Комплексный административный интерфейс с метриками в реальном времени |
| `OrganizationManager` | Управление жизненным циклом мульти-тенантных организаций |
| `ContentManager` | CMS интерфейс для блогов и статей помощи |
| `QuizBuilder` | Интерактивное создание и управление викторинами |

## Интеграция API

Фронтенд взаимодействует с бэкендом GraphTalk через:

### REST API конечные точки
- **Аутентификация**: `/login`, `/logout`, `/organizations`
- **Операции с файлами**: Загрузка, загрузка и управление метаданными
- **Управление пользователями**: Профиль, настройки и предпочтения
- **Административные функции**: Управление организациями, аналитика, управление контентом
- **Система викторин**: Создание викторин, отправка ответов и аналитика
- **CMS API**: Посты в блоге, статьи помощи и управление медиа

### Подключение WebSocket
- **Потоковая передача в реальном времени**: `/ws/query` для ответов ИИ токен-за-токеном
- **Обновления в реальном времени**: Уведомления и обновления статуса в реальном времени
- **Интерактивный чат**: Постоянные сессии чата с историей

### Конфигурация на основе окружения
Все вызовы API используют конфигурацию на основе окружения для легкого переключения бэкенда между разработкой, тестированием и продакшеном.

## Разработка

### Локальная разработка

```bash
# Запуск сервера разработки
pnpm dev

# Запуск линтера
pnpm lint

# Проверка типов
pnpm type-check
```

### Сборка и развертывание

```bash
# Сборка для продакшена
pnpm build

# Запуск продакшн сервера
pnpm start

# Экспорт статического сайта (если необходимо)
pnpm export
```

### Переменные окружения

Ключевые переменные окружения для разработки:

```bash
# URL бэкенд API
NEXT_PUBLIC_API_URL=http://localhost:9001
NEXT_PUBLIC_WS_URL=ws://localhost:9001

# Настройки приложения
NEXT_PUBLIC_APP_NAME=WikiAI
NEXT_PUBLIC_APP_VERSION=1.0.0

# Флаги функций
NEXT_PUBLIC_ENABLE_AI_AGENT=true
NEXT_PUBLIC_ENABLE_ANALYTICS=true
NEXT_PUBLIC_ENABLE_CMS=true
```

## Документация

- [Руководство по использованию AI-агента](AI_AGENT_USAGE_GUIDE.md) - Комплексное руководство по командам AI-агента
- [Унифицированная конфигурация бэкенда](UNIFIED_BACKEND_CONFIG.md) - Конфигурация интеграции с бэкендом
- [Потоковая передача WebSocket](REACT_WEBSOCKET_STREAMING_COMPLETE.md) - Реализация потоковой передачи в реальном времени
- [README компонентов](components/ui/README.md) - Документация UI компонентов
- [Обзор реализации](IMPLEMENTATION_SUMMARY.md) - Обзор реализации проекта

## Вклад в проект

1. Форкните репозиторий
2. Создайте ветку функций (`git checkout -b feature/amazing-feature`)
3. Зафиксируйте изменения (`git commit -m 'Add amazing feature'`)
4. Отправьте в ветку (`git push origin feature/amazing-feature`)
5. Откройте Pull Request

### Рекомендации по разработке

- Следуйте лучшим практикам TypeScript
- Используйте Tailwind CSS для стилизации
- Реализуйте proper обработку ошибок
- Добавляйте модульные тесты для новых функций
- Обновляйте документацию для изменений API

## Лицензия

Этот проект является частным и собственническим.

## Поддержка

Для поддержки и вопросов:
- Проверьте документацию в директории `/docs`
- Ознакомьтесь с руководствами по реализации
- Свяжитесь с командой разработки через каналы проекта
